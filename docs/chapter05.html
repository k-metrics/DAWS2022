<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-0.9.440">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="description" content="本書はデータ分析勉強会で学んだ成果をまとめたものです。">
<title>Rで学ぶ『完全独習 統計学入門』 - 5&nbsp; 標準偏差は株のリスクの指標として活用できる</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>
<script src="site_libs/quarto-nav/quarto-nav.js"></script><script src="site_libs/quarto-nav/headroom.min.js"></script><script src="site_libs/clipboard/clipboard.min.js"></script><meta name="quarto:offset" content="./">
<script src="site_libs/quarto-search/autocomplete.umd.js"></script><script src="site_libs/quarto-search/fuse.min.js"></script><script src="site_libs/quarto-search/quarto-search.js"></script><link href="./chapter04.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script><script src="site_libs/quarto-html/popper.min.js"></script><script src="site_libs/quarto-html/tippy.umd.min.js"></script><script src="site_libs/quarto-html/anchor.min.js"></script><link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link class="quarto-color-scheme" id="quarto-text-highlighting-styles" href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet">
<link class="quarto-color-scheme quarto-color-alternate" rel="prefetch" id="quarto-text-highlighting-styles" href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css">
<script src="site_libs/bootstrap/bootstrap.min.js"></script><link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link class="quarto-color-scheme" href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet">
<link class="quarto-color-scheme quarto-color-alternate" rel="prefetch" href="site_libs/bootstrap/bootstrap-dark.min.css">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }"><div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">
<span class="chapter-number">5</span>&nbsp; <span class="chapter-title">標準偏差は株のリスクの指標として活用できる</span>
</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav></header><!-- content --><header id="title-block-header" class="quarto-title-block default page-columns page-full"><div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title d-none d-lg-block">
<span class="chapter-number">5</span>&nbsp; <span class="chapter-title">標準偏差は株のリスクの指標として活用できる</span>
</h1>
                  <div>
        <div class="description">
          本書はデータ分析勉強会で学んだ成果をまとめたものです。
        </div>
      </div>
                </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Rで学ぶ『完全独習 統計学入門』</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/k-metrics/DAWS2022/" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
    <a href="" title="Share" id="sidebar-tool-dropdown-0" class="sidebar-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-share"></i></a>
    <ul class="dropdown-menu" aria-labelledby="sidebar-tool-dropdown-0">
<li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=%7Curl%7C">
            <i class="bi bi-bi-twitter pe-1"></i>
          Twitter
          </a>
        </li>
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=%7Curl%7C">
            <i class="bi bi-bi-facebook pe-1"></i>
          Facebook
          </a>
        </li>
    </ul>
<a href="" class="quarto-color-scheme-toggle sidebar-tool" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">はじめに</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter00.html" class="sidebar-item-text sidebar-link">なぜ、統計手法が必要か</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter01.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">度数分布表とヒストグラムでデータの特徴を浮き彫りにする</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter02.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">平均値とはやじろべえの視点である</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter03.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">データの散らばり具合を見積もる統計量</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter04.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">そのデータは「月並み」か「特殊」か？ 標準偏差で評価する</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter05.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">標準偏差は株のリスクの指標として活用できる</span></a>
  </div>
</li>
    </ul>
</div>
</nav><!-- margin-sidebar --><div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#%E6%A0%AA%E3%81%AE%E5%B9%B3%E5%9D%87%E5%8F%8E%E7%9B%8A%E7%8E%87%E3%81%A8%E3%81%AF%E4%BD%95%E3%81%8B" id="toc-株の平均収益率とは何か" class="nav-link active" data-scroll-target="#%E6%A0%AA%E3%81%AE%E5%B9%B3%E5%9D%87%E5%8F%8E%E7%9B%8A%E7%8E%87%E3%81%A8%E3%81%AF%E4%BD%95%E3%81%8B"> <span class="header-section-number">5.1</span> 株の平均収益率とは何か？</a></li>
  <li><a href="#%E5%B9%B3%E5%9D%87%E5%8F%8E%E7%9B%8A%E7%8E%87%E3%81%A0%E3%81%91%E3%81%A7%E3%81%AF%E5%84%AA%E8%89%AF%E3%81%AA%E6%8A%95%E8%B3%87%E3%81%8B%E3%81%A9%E3%81%86%E3%81%8B%E3%81%AF%E5%88%A4%E6%96%AD%E3%81%A7%E3%81%8D%E3%81%AA%E3%81%84" id="toc-平均収益率だけでは優良な投資かどうかは判断できない" class="nav-link" data-scroll-target="#%E5%B9%B3%E5%9D%87%E5%8F%8E%E7%9B%8A%E7%8E%87%E3%81%A0%E3%81%91%E3%81%A7%E3%81%AF%E5%84%AA%E8%89%AF%E3%81%AA%E6%8A%95%E8%B3%87%E3%81%8B%E3%81%A9%E3%81%86%E3%81%8B%E3%81%AF%E5%88%A4%E6%96%AD%E3%81%A7%E3%81%8D%E3%81%AA%E3%81%84"> <span class="header-section-number">5.2</span> 平均収益率だけでは、優良な投資かどうかは判断できない</a></li>
  <li><a href="#%E3%83%9C%E3%83%A9%E3%83%AA%E3%83%86%E3%82%A3%E3%81%8C%E6%84%8F%E5%91%B3%E3%81%99%E3%82%8B%E3%81%A8%E3%81%93%E3%82%8D" id="toc-ボラリティが意味するところ" class="nav-link" data-scroll-target="#%E3%83%9C%E3%83%A9%E3%83%AA%E3%83%86%E3%82%A3%E3%81%8C%E6%84%8F%E5%91%B3%E3%81%99%E3%82%8B%E3%81%A8%E3%81%93%E3%82%8D"> <span class="header-section-number">5.3</span> ボラリティが意味するところ</a></li>
  <li><a href="#%E7%B7%B4%E7%BF%92%E5%95%8F%E9%A1%8C" id="toc-練習問題" class="nav-link" data-scroll-target="#%E7%B7%B4%E7%BF%92%E5%95%8F%E9%A1%8C">練習問題</a></li>
  <li>
<a href="#%E5%AE%9F%E9%9A%9B%E3%81%AE%E6%A0%AA%E4%BE%A1%E3%81%A7%E8%A8%88%E7%AE%97%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B" id="toc-実際の株価で計算してみる" class="nav-link" data-scroll-target="#%E5%AE%9F%E9%9A%9B%E3%81%AE%E6%A0%AA%E4%BE%A1%E3%81%A7%E8%A8%88%E7%AE%97%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B">実際の株価で計算してみる</a>
  <ul class="collapse">
<li><a href="#%E8%A4%87%E6%95%B0%E3%81%AE%E6%A0%AA%E3%82%92%E6%AF%94%E8%BC%83%E3%81%99%E3%82%8B" id="toc-複数の株を比較する" class="nav-link" data-scroll-target="#%E8%A4%87%E6%95%B0%E3%81%AE%E6%A0%AA%E3%82%92%E6%AF%94%E8%BC%83%E3%81%99%E3%82%8B"> <span class="header-section-number">5.3.1</span> 複数の株を比較する</a></li>
  </ul>
</li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/k-metrics/DAWS2022/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content"><div class="cell">

</div>
<section id="株の平均収益率とは何か" class="level2" data-number="5.1"><h2 data-number="5.1" class="anchored" data-anchor-id="株の平均収益率とは何か">
<span class="header-section-number">5.1</span> 株の平均収益率とは何か？</h2>
<p>　株価の変動を利用して得られる収益は「キャピタルゲイン」と呼ばれます。キャピタルゲインを目当てとした株取引で重要になる指標のひとつに「収益率」があります。毎月の終値が前月の終値に対して、値上がった、または、値下がった率を「月次収益率」といいます。「月次平均収益率」は、月次収益率の一年間（十二ヶ月）単位で平均した値になります。<br>
　</p>
</section><section id="平均収益率だけでは優良な投資かどうかは判断できない" class="level2" data-number="5.2"><h2 data-number="5.2" class="anchored" data-anchor-id="平均収益率だけでは優良な投資かどうかは判断できない">
<span class="header-section-number">5.2</span> 平均収益率だけでは、優良な投資かどうかは判断できない</h2>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="st">"./data/P56_ 図表5-3.csv"</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">df_print</span><span class="op">(</span><span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["月"],"name":[1],"type":["chr"],"align":["left"]},{"label":["X1980年"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["X1981年"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["X1982年"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["X1983年"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["X1984年"],"name":[6],"type":["dbl"],"align":["right"]}],"data":[{"1":"1月","2":"9.2","3":"2.8","4":"-0.6","5":"-2.8","6":"0.0"},{"1":"2月","2":"2.3","3":"-1.4","4":"-11.8","5":"9.3","6":"-5.7"},{"1":"3月","2":"-6.5","3":"17.6","4":"3.5","5":"11.4","6":"10.6"},{"1":"4月","2":"9.0","3":"17.8","4":"1.9","5":"3.0","6":"-0.6"},{"1":"5月","2":"5.3","3":"5.5","4":"-5.5","5":"-7.5","6":"-11.2"},{"1":"6月","2":"-4.3","3":"-1.9","4":"-9.1","5":"2.5","6":"-3.8"},{"1":"7月","2":"-3.7","3":"1.9","4":"-5.7","5":"-0.6","6":"-5.2"},{"1":"8月","2":"7.0","3":"9.0","4":"2.3","5":"1.8","6":"6.2"},{"1":"9月","2":"7.6","3":"-10.3","4":"-4.9","5":"5.1","6":"-4.2"},{"1":"10月","2":"1.4","3":"-10.3","4":"-0.8","5":"-2.3","6":"2.1"},{"1":"11月","2":"-3.4","3":"-7.7","4":"8.0","5":"-6.0","6":"0.6"},{"1":"12月","2":"0.7","3":"6.5","4":"6.7","5":"10.6","6":"4.7"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div class="cell">
<details open=""><summary>月次平均収益率を求める</summary><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="st">"./data/P56_ 図表5-3.csv"</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html">summarise_if</a></span><span class="op">(</span><span class="va">is.numeric</span>, <span class="va">mean</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">df_print</span><span class="op">(</span><span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["X1980年"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["X1981年"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["X1982年"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["X1983年"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["X1984年"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"2.05","2":"2.46","3":"-1.33","4":"2.04","5":"-0.54"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div class="cell">
<details open=""><summary>月次平均収益率の標準偏差を求める</summary><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="st">"./data/P56_ 図表5-3.csv"</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html">summarise_if</a></span><span class="op">(</span><span class="va">is.numeric</span>, <span class="va">SD</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">df_print</span><span class="op">(</span><span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["X1980年"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["X1981年"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["X1982年"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["X1983年"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["X1984年"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"5.35","2":"9.11","3":"5.91","4":"5.98","5":"5.71"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>　</p>
</section><section id="ボラリティが意味するところ" class="level2" data-number="5.3"><h2 data-number="5.3" class="anchored" data-anchor-id="ボラリティが意味するところ">
<span class="header-section-number">5.3</span> ボラリティが意味するところ</h2>
<p>　ボラリティ（予想変動率）とは標準偏差、つまり平均値からのブレ（バラツキ）のことです。例えば1981年の月次平均収益率は<span class="math inline">\(2.46\%\)</span>、標準偏差は<span class="math inline">\(9.11\%\)</span>なので、概ね下図のマゼンタ色のラインの間で変動していると想定できます。</p>
<div class="cell">
<details open=""><summary>1981年の月次収益率</summary><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="st">"./data/P56_ 図表5-3.csv"</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>月 <span class="op">=</span> <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_inorder.html">fct_inorder</a></span><span class="op">(</span><span class="va">月</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">月</span>, y <span class="op">=</span> <span class="va">X1981年</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">2.46</span>, colour <span class="op">=</span> <span class="st">"lightskyblue"</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2.46</span> <span class="op">+</span> <span class="fl">9.11</span>, <span class="fl">2.46</span> <span class="op">-</span> <span class="fl">9.11</span><span class="op">)</span>,
                        colour <span class="op">=</span> <span class="st">"magenta"</span><span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="chapter05_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section><section id="練習問題" class="level2 unnumbered"><h2 class="unnumbered anchored" data-anchor-id="練習問題">練習問題</h2>
<p>　（省略）</p>
<p>　</p>
</section><section id="実際の株価で計算してみる" class="level2 unnumbered"><h2 class="unnumbered anchored" data-anchor-id="実際の株価で計算してみる">実際の株価で計算してみる</h2>
<p>　実際に<a href="https://kabutan.jp/">株探</a>というサイトから某社の月次株価一覧を取得して月次平均収益率を計算してみます。</p>
<div class="cell">
<details><summary>サイトから株価データを取得する</summary><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rvest.tidyverse.org/">rvest</a></span><span class="op">)</span>

<span class="va">site_url</span> <span class="op">&lt;-</span> <span class="st">"https://kabutan.jp/stock/kabuka?code=7203&amp;ashi=mon&amp;page="</span>
<span class="va">pages</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>
<span class="va">xpath</span> <span class="op">&lt;-</span> <span class="st">'//*[@id="stock_kabuka_table"]/table[2]'</span>

<span class="va">stock</span> <span class="op">&lt;-</span> <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand.html">crossing</a></span><span class="op">(</span><span class="va">site_url</span>, <span class="va">pages</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>url <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">site_url</span>, <span class="va">pages</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">url</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_df</a></span><span class="op">(</span>.f <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">.x</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu">xml2</span><span class="fu">::</span><span class="fu"><a href="http://xml2.r-lib.org/reference/read_xml.html">read_html</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
      <span class="fu">rvest</span><span class="fu">::</span><span class="fu"><a href="https://rvest.tidyverse.org/reference/html_element.html">html_element</a></span><span class="op">(</span>xpath <span class="op">=</span> <span class="va">xpath</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
      <span class="fu">rvest</span><span class="fu">::</span><span class="fu"><a href="https://rvest.tidyverse.org/reference/html_table.html">html_table</a></span><span class="op">(</span>header <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>
  <span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span>.col <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span>,
                              .f <span class="op">=</span> <span class="fu">readr</span><span class="fu">::</span><span class="va"><a href="https://readr.tidyverse.org/reference/parse_guess.html">parse_guess</a></span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>X1 <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/as_date.html">as_date</a></span><span class="op">(</span><span class="va">X1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>`日付` <span class="op">=</span> <span class="va">X1</span>, `始値` <span class="op">=</span> <span class="va">X2</span>, `高値` <span class="op">=</span> <span class="va">X3</span>, `安値` <span class="op">=</span> <span class="va">X4</span>,
                `終値` <span class="op">=</span> <span class="va">X5</span>, `前月比` <span class="op">=</span> <span class="va">X6</span>, `月次収益率` <span class="op">=</span> <span class="va">X7</span>, `売買高` <span class="op">=</span> <span class="va">X8</span><span class="op">)</span>

<span class="va">stock</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">df_print</span><span class="op">(</span><span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["日付"],"name":[1],"type":["date"],"align":["right"]},{"label":["始値"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["高値"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["安値"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["終値"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["前月比"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["月次収益率"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["売買高"],"name":[8],"type":["dbl"],"align":["right"]}],"data":[{"1":"2022-05-31","2":"2267.0","3":"2282.5","4":"1971.0","5":"2122.5","6":"-113.0","7":"-5.1","8":"545952200"},{"1":"2022-04-28","2":"2222.5","3":"2269.0","4":"2065.5","5":"2235.5","6":"13.0","7":"0.6","8":"527209900"},{"1":"2022-03-31","2":"2119.5","3":"2262.0","4":"1805.0","5":"2222.5","6":"84.0","7":"3.9","8":"808023700"},{"1":"2022-02-28","2":"2261.0","3":"2375.5","4":"2078.5","5":"2138.5","6":"-107.0","7":"-4.8","8":"477052100"},{"1":"2022-01-31","2":"2158.0","3":"2475.0","4":"2154.5","5":"2245.5","6":"140.0","7":"6.6","8":"668062900"},{"1":"2021-12-30","2":"2007.5","3":"2165.0","4":"2002.0","5":"2105.5","6":"104.5","7":"5.2","8":"482973600"},{"1":"2021-11-30","2":"2028.0","3":"2188.0","4":"1995.0","5":"2001.0","6":"-5.5","7":"-0.3","8":"444785600"},{"1":"2021-10-29","2":"1980.0","3":"2062.0","4":"1818.0","5":"2006.5","6":"6.5","7":"0.3","8":"412365500"},{"1":"2021-09-30","2":"1940.2","3":"2092.0","4":"1918.4","5":"2000.0","6":"81.6","7":"4.3","8":"597068400"},{"1":"2021-08-31","2":"1977.4","3":"2029.0","4":"1772.8","5":"1918.4","6":"-42.6","7":"-2.2","8":"634271500"},{"1":"2021-07-30","2":"1945.6","3":"2002.0","4":"1894.4","5":"1961.0","6":"19.0","7":"1.0","8":"452708000"},{"1":"2021-06-30","2":"1826.0","3":"2066.0","4":"1826.0","5":"1942.0","6":"119.0","7":"6.5","8":"734296000"},{"1":"2021-05-31","2":"1670.0","3":"1845.4","4":"1636.8","5":"1823.0","6":"197.6","7":"12.2","8":"611082000"},{"1":"2021-04-30","2":"1738.8","3":"1739.0","4":"1622.0","5":"1625.4","6":"-97.8","7":"-5.7","8":"513436000"},{"1":"2021-03-31","2":"1582.2","3":"1742.4","4":"1557.2","5":"1723.2","6":"148.6","7":"9.4","8":"813757500"},{"1":"2021-02-26","2":"1455.6","3":"1699.4","4":"1443.2","5":"1574.6","6":"114.6","7":"7.8","8":"645335500"},{"1":"2021-01-29","2":"1606.0","3":"1606.0","4":"1459.6","5":"1460.0","6":"-131.4","7":"-8.3","8":"588137500"},{"1":"2020-12-30","2":"1422.2","3":"1609.0","4":"1396.0","5":"1591.4","6":"191.6","7":"13.7","8":"614474000"},{"1":"2020-11-30","2":"1373.2","3":"1504.8","4":"1370.0","5":"1399.8","6":"39.2","7":"2.9","8":"629735000"},{"1":"2020-10-30","2":"1384.0","3":"1415.6","4":"1356.0","5":"1360.6","6":"-25.8","7":"-1.9","8":"392062500"},{"1":"2020-09-30","2":"1398.0","3":"1435.8","4":"1367.6","5":"1386.4","6":"-14.8","7":"-1.1","8":"462462000"},{"1":"2020-08-31","2":"1261.8","3":"1476.0","4":"1251.0","5":"1401.2","6":"157.8","7":"12.7","8":"501836000"},{"1":"2020-07-31","2":"1352.0","3":"1374.0","4":"1243.4","5":"1243.4","6":"-109.0","7":"-8.1","8":"493403500"},{"1":"2020-06-30","2":"1357.0","3":"1434.8","4":"1337.0","5":"1352.4","6":"1.4","7":"0.1","8":"598903500"},{"1":"2020-05-29","2":"1320.6","3":"1396.0","4":"1241.6","5":"1351.0","6":"17.8","7":"1.3","8":"622689500"},{"1":"2020-04-30","2":"1286.0","3":"1375.0","4":"1232.6","5":"1333.2","6":"33.0","7":"2.5","8":"680941500"},{"1":"2020-03-31","2":"1388.2","3":"1469.6","4":"1154.2","5":"1300.2","6":"-125.2","7":"-8.8","8":"1215537000"},{"1":"2020-02-28","2":"1511.4","3":"1605.2","4":"1400.8","5":"1425.4","6":"-105.0","7":"-6.9","8":"522169000"},{"1":"2020-01-31","2":"1519.8","3":"1578.8","4":"1506.0","5":"1530.4","6":"-12.4","7":"-0.8","8":"428432500"},{"1":"2019-12-30","2":"1540.2","3":"1570.8","4":"1525.2","5":"1542.8","6":"15.2","7":"1.0","8":"387589000"},{"1":"2019-11-29","2":"1492.0","3":"1589.8","4":"1491.6","5":"1527.6","6":"19.2","7":"1.3","8":"449681500"},{"1":"2019-10-31","2":"1449.0","3":"1510.8","4":"1390.2","5":"1508.4","6":"65.2","7":"4.5","8":"452198500"},{"1":"2019-09-30","2":"1393.4","3":"1498.8","4":"1386.6","5":"1443.2","6":"51.2","7":"3.7","8":"545344000"},{"1":"2019-08-30","2":"1403.6","3":"1424.0","4":"1324.0","5":"1392.0","6":"-12.8","7":"-0.9","8":"529756000"},{"1":"2019-07-31","2":"1353.0","3":"1448.8","4":"1345.4","5":"1404.8","6":"67.2","7":"5.0","8":"520886500"},{"1":"2019-06-28","2":"1261.8","3":"1371.6","4":"1254.8","5":"1337.6","6":"60.8","7":"4.8","8":"470173500"},{"1":"2019-05-31","2":"1371.0","3":"1380.0","4":"1276.6","5":"1276.8","6":"-104.2","7":"-7.5","8":"490762000"},{"1":"2019-04-26","2":"1314.2","3":"1416.0","4":"1311.4","5":"1381.0","6":"83.6","7":"6.4","8":"406446500"},{"1":"2019-03-29","2":"1347.0","3":"1352.2","4":"1297.4","5":"1297.4","6":"-42.0","7":"-3.1","8":"495195500"},{"1":"2019-02-28","2":"1328.4","3":"1361.6","4":"1286.0","5":"1339.4","6":"4.4","7":"0.3","8":"475019000"},{"1":"2019-01-31","2":"1236.0","3":"1381.0","4":"1232.2","5":"1335.0","6":"53.8","7":"4.2","8":"588142000"},{"1":"2018-12-28","2":"1400.0","3":"1419.4","4":"1209.0","5":"1281.2","6":"-79.4","7":"-5.8","8":"661066000"},{"1":"2018-11-30","2":"1325.6","3":"1406.8","4":"1285.6","5":"1360.6","6":"37.6","7":"2.8","8":"782808000"},{"1":"2018-10-31","2":"1410.8","3":"1451.4","4":"1279.2","5":"1323.0","6":"-96.0","7":"-6.8","8":"899652500"},{"1":"2018-09-28","2":"1370.2","3":"1426.8","4":"1310.4","5":"1419.0","6":"33.0","7":"2.4","8":"607170500"},{"1":"2018-08-31","2":"1484.4","3":"1485.6","4":"1339.2","5":"1386.0","6":"-75.0","7":"-5.1","8":"605631500"},{"1":"2018-07-31","2":"1430.0","3":"1505.2","4":"1404.6","5":"1461.0","6":"27.0","7":"1.9","8":"625806000"},{"1":"2018-06-29","2":"1390.0","3":"1523.0","4":"1388.2","5":"1434.0","6":"49.8","7":"3.6","8":"808551500"},{"1":"2018-05-31","2":"1436.2","3":"1537.2","4":"1365.0","5":"1384.2","6":"-52.0","7":"-3.6","8":"815276500"},{"1":"2018-04-27","2":"1366.6","3":"1448.6","4":"1337.4","5":"1436.2","6":"71.2","7":"5.2","8":"427299000"},{"1":"2018-03-30","2":"1439.4","3":"1439.6","4":"1306.2","5":"1365.0","6":"-82.0","7":"-5.7","8":"619429000"},{"1":"2018-02-28","2":"1504.0","3":"1540.8","4":"1416.0","5":"1447.0","6":"-49.0","7":"-3.3","8":"684935500"},{"1":"2018-01-31","2":"1460.0","3":"1561.2","4":"1458.6","5":"1496.0","6":"53.4","7":"3.7","8":"661641000"},{"1":"2017-12-29","2":"1416.2","3":"1460.0","4":"1367.0","5":"1442.6","6":"33.8","7":"2.4","8":"538372500"},{"1":"2017-11-30","2":"1404.0","3":"1462.4","4":"1380.4","5":"1408.8","6":"10.8","7":"0.8","8":"644089500"},{"1":"2017-10-31","2":"1343.2","3":"1417.2","4":"1334.0","5":"1398.0","6":"56.0","7":"4.2","8":"674073500"},{"1":"2017-09-29","2":"1243.0","3":"1366.4","4":"1227.4","5":"1342.0","6":"105.4","7":"8.5","8":"645977500"},{"1":"2017-08-31","2":"1247.8","3":"1272.0","4":"1213.4","5":"1236.6","6":"-10.2","7":"-0.8","8":"685326000"},{"1":"2017-07-31","2":"1178.6","3":"1256.4","4":"1177.4","5":"1246.8","6":"68.2","7":"5.8","8":"831339500"},{"1":"2017-06-30","2":"1187.0","3":"1219.4","4":"1153.6","5":"1178.6","6":"-7.8","7":"-0.7","8":"711135500"},{"1":"2017-05-31","2":"1204.8","3":"1248.4","4":"1184.6","5":"1186.4","6":"-20.6","7":"-1.7","8":"625222500"},{"1":"2017-04-28","2":"1217.4","3":"1230.8","4":"1134.0","5":"1207.0","6":"-1.4","7":"-0.1","8":"692857000"},{"1":"2017-03-31","2":"1284.0","3":"1310.0","4":"1208.4","5":"1208.4","6":"-64.6","7":"-5.1","8":"696287500"},{"1":"2017-02-28","2":"1298.0","3":"1311.6","4":"1244.0","5":"1273.0","6":"-43.8","7":"-3.3","8":"683961500"},{"1":"2017-01-31","2":"1402.0","3":"1420.6","4":"1315.0","5":"1316.8","6":"-58.8","7":"-4.3","8":"736449500"},{"1":"2016-12-30","2":"1357.8","3":"1443.0","4":"1318.4","5":"1375.6","6":"45.8","7":"3.4","8":"964582000"},{"1":"2016-11-30","2":"1216.4","3":"1357.8","4":"1098.4","5":"1329.8","6":"114.0","7":"9.4","8":"1172406500"},{"1":"2016-10-31","2":"1166.0","3":"1216.0","4":"1158.2","5":"1215.8","6":"60.0","7":"5.2","8":"604196000"},{"1":"2016-09-30","2":"1252.4","3":"1274.4","4":"1140.6","5":"1155.8","6":"-91.8","7":"-7.4","8":"821137000"},{"1":"2016-08-31","2":"1143.0","3":"1270.6","4":"1104.0","5":"1247.6","6":"68.8","7":"5.8","8":"1134393500"},{"1":"2016-07-29","2":"1020.0","3":"1184.0","4":"993.0","5":"1178.8","6":"168.4","7":"16.7","8":"1185565000"},{"1":"2016-06-30","2":"1140.2","3":"1168.8","4":"983.4","5":"1010.4","6":"-146.2","7":"-12.6","8":"1396955000"},{"1":"2016-05-31","2":"1080.8","3":"1167.8","4":"1075.0","5":"1156.6","6":"25.8","7":"2.3","8":"930814500"},{"1":"2016-04-28","2":"1186.0","3":"1205.4","4":"1051.2","5":"1130.8","6":"-59.6","7":"-5.0","8":"1247241500"},{"1":"2016-03-31","2":"1170.6","3":"1248.8","4":"1164.8","5":"1190.4","6":"11.0","7":"0.9","8":"1143314000"},{"1":"2016-02-29","2":"1460.0","3":"1471.0","4":"1140.6","5":"1179.4","6":"-260.6","7":"-18.1","8":"1432975500"},{"1":"2016-01-29","2":"1480.0","3":"1499.0","4":"1278.4","5":"1440.0","6":"-57.6","7":"-3.8","8":"1146799500"},{"1":"2015-12-30","2":"1538.2","3":"1572.4","4":"1464.8","5":"1497.6","6":"-33.8","7":"-2.2","8":"958060500"},{"1":"2015-11-30","2":"1476.0","3":"1543.4","4":"1466.2","5":"1531.4","6":"37.6","7":"2.5","8":"718945500"},{"1":"2015-10-30","2":"1404.0","3":"1533.6","4":"1392.2","5":"1493.8","6":"99.6","7":"7.1","8":"1107272500"},{"1":"2015-09-30","2":"1424.8","3":"1498.2","4":"1333.8","5":"1394.2","6":"-44.2","7":"-3.1","8":"1204992000"},{"1":"2015-08-31","2":"1647.8","3":"1647.8","4":"1330.0","5":"1438.4","6":"-212.2","7":"-12.9","8":"1089105000"},{"1":"2015-07-31","2":"1635.6","3":"1688.8","4":"1526.0","5":"1650.6","6":"10.0","7":"0.6","8":"751139500"},{"1":"2015-06-30","2":"1714.6","3":"1718.6","4":"1619.0","5":"1640.6","6":"-80.2","7":"-4.7","8":"745876000"},{"1":"2015-05-29","2":"1659.6","3":"1740.0","4":"1630.0","5":"1720.8","6":"49.2","7":"2.9","8":"681282500"},{"1":"2015-04-30","2":"1653.6","3":"1707.0","4":"1635.0","5":"1671.6","6":"-5.0","7":"-0.3","8":"746838500"},{"1":"2015-03-31","2":"1623.0","3":"1756.6","4":"1605.8","5":"1676.6","6":"64.0","7":"4.0","8":"977391000"},{"1":"2015-02-27","2":"1510.2","3":"1645.8","4":"1499.0","5":"1612.6","6":"83.6","7":"5.5","8":"852052000"},{"1":"2015-01-30","2":"1513.0","3":"1566.8","4":"1451.0","5":"1529.0","6":"17.4","7":"1.2","8":"953544000"},{"1":"2014-12-30","2":"1472.0","3":"1574.6","4":"1421.4","5":"1511.6","6":"48.8","7":"3.3","8":"1222919000"},{"1":"2014-11-28","2":"1366.0","3":"1462.8","4":"1339.2","5":"1462.8","6":"163.2","7":"12.6","8":"1160243500"},{"1":"2014-10-31","2":"1290.0","3":"1311.8","4":"1142.0","5":"1299.6","6":"7.0","7":"0.5","8":"1166767000"},{"1":"2014-09-30","2":"1192.6","3":"1310.0","4":"1187.6","5":"1292.6","6":"107.0","7":"9.0","8":"936181000"},{"1":"2014-08-29","2":"1217.0","3":"1223.4","4":"1170.0","5":"1185.6","6":"-41.8","7":"-3.4","8":"640258500"},{"1":"2014-07-31","2":"1220.0","3":"1244.2","4":"1185.2","5":"1227.4","6":"10.6","7":"0.9","8":"711210500"},{"1":"2014-06-30","2":"1155.8","3":"1218.0","4":"1154.2","5":"1216.8","6":"64.6","7":"5.6","8":"789551500"},{"1":"2014-05-30","2":"1115.4","3":"1152.2","4":"1075.2","5":"1152.2","6":"49.0","7":"4.4","8":"663284000"},{"1":"2014-04-30","2":"1167.8","3":"1181.2","4":"1041.0","5":"1103.2","6":"-62.0","7":"-5.3","8":"854024000"},{"1":"2014-03-31","2":"1158.6","3":"1191.0","4":"1083.0","5":"1165.2","6":"-2.6","7":"-0.2","8":"815719500"},{"1":"2014-02-28","2":"1176.0","3":"1209.0","4":"1100.0","5":"1167.8","6":"-16.6","7":"-1.4","8":"861875500"},{"1":"2014-01-31","2":"1272.0","3":"1280.0","4":"1177.2","5":"1184.4","6":"-99.6","7":"-7.8","8":"977056000"},{"1":"2013-12-30","2":"1278.0","3":"1286.0","4":"1208.0","5":"1284.0","6":"8.0","7":"0.6","8":"1019388500"},{"1":"2013-11-29","2":"1278.0","3":"1286.0","4":"1236.0","5":"1276.0","6":"4.0","7":"0.3","8":"923665500"},{"1":"2013-10-31","2":"1262.0","3":"1286.0","4":"1202.0","5":"1272.0","6":"18.0","7":"1.4","8":"904801500"},{"1":"2013-09-30","2":"1196.0","3":"1304.0","4":"1194.0","5":"1254.0","6":"66.0","7":"5.6","8":"723283500"},{"1":"2013-08-30","2":"1206.0","3":"1300.0","4":"1188.0","5":"1188.0","6":"-6.0","7":"-0.5","8":"1091712500"},{"1":"2013-07-31","2":"1214.0","3":"1308.0","4":"1178.0","5":"1194.0","6":"-4.0","7":"-0.3","8":"1059385500"},{"1":"2013-06-28","2":"1182.0","3":"1210.0","4":"1072.0","5":"1198.0","6":"-4.0","7":"-0.3","8":"1663320500"},{"1":"2013-05-31","2":"1128.0","3":"1352.0","4":"1092.0","5":"1202.0","6":"74.0","7":"6.6","8":"1935922500"},{"1":"2013-04-30","2":"979.0","3":"1158.0","4":"922.0","5":"1128.0","6":"156.0","7":"16.0","8":"1463267500"},{"1":"2013-03-29","2":"943.0","3":"1010.0","4":"940.0","5":"972.0","6":"19.0","7":"2.0","8":"1050667500"},{"1":"2013-02-28","2":"884.0","3":"1010.0","4":"883.0","5":"953.0","6":"80.0","7":"9.2","8":"1420666500"},{"1":"2013-01-31","2":"840.0","3":"878.0","4":"806.0","5":"873.0","6":"72.0","7":"9.0","8":"1036461500"},{"1":"2012-12-28","2":"708.0","3":"803.0","4":"692.0","5":"801.0","6":"94.0","7":"13.3","8":"839755500"},{"1":"2012-11-30","2":"616.0","3":"732.0","4":"610.0","5":"707.0","6":"94.0","7":"15.3","8":"832196500"},{"1":"2012-10-31","2":"602.0","3":"638.0","4":"574.6","5":"613.0","6":"5.0","7":"0.8","8":"685717500"},{"1":"2012-09-28","2":"618.0","3":"656.0","4":"604.0","5":"608.0","6":"-11.0","7":"-1.8","8":"590588000"},{"1":"2012-08-31","2":"596.0","3":"660.0","4":"596.0","5":"619.0","6":"15.0","7":"2.5","8":"664328500"},{"1":"2012-07-31","2":"646.0","3":"652.0","4":"559.0","5":"604.0","6":"-34.0","7":"-5.3","8":"576444000"},{"1":"2012-06-29","2":"596.4","3":"644.0","4":"577.0","5":"638.0","6":"30.0","7":"4.9","8":"788557000"},{"1":"2012-05-31","2":"656.0","3":"656.0","4":"598.0","5":"608.0","6":"-53.0","7":"-8.0","8":"770086000"},{"1":"2012-04-27","2":"721.0","3":"728.0","4":"645.0","5":"661.0","6":"-53.0","7":"-7.4","8":"749429500"},{"1":"2012-03-30","2":"676.0","3":"727.0","4":"644.0","5":"714.0","6":"43.0","7":"6.4","8":"950259500"},{"1":"2012-02-29","2":"559.0","3":"692.0","4":"556.8","5":"671.0","6":"109.0","7":"19.4","8":"1019537500"},{"1":"2012-01-31","2":"522.2","3":"581.2","4":"510.6","5":"562.0","6":"49.0","7":"9.6","8":"681636000"},{"1":"2011-12-30","2":"517.0","3":"538.0","4":"494.4","5":"513.0","6":"11.2","7":"2.2","8":"642291500"},{"1":"2011-11-30","2":"520.4","3":"525.0","4":"466.0","5":"501.8","6":"-27.0","7":"-5.1","8":"752757500"},{"1":"2011-10-31","2":"525.8","3":"542.0","4":"500.0","5":"528.8","6":"-8.8","7":"-1.6","8":"628956500"},{"1":"2011-09-30","2":"548.0","3":"556.0","4":"512.4","5":"537.6","6":"-9.2","7":"-1.7","8":"879329500"},{"1":"2011-08-31","2":"634.0","3":"644.0","4":"539.2","5":"546.8","6":"-84.2","7":"-13.3","8":"1251909500"},{"1":"2011-07-29","2":"664.0","3":"696.0","4":"629.0","5":"631.0","6":"-29.0","7":"-4.4","8":"624119500"},{"1":"2011-06-30","2":"683.0","3":"684.0","4":"631.0","5":"660.0","6":"-20.0","7":"-2.9","8":"726580500"},{"1":"2011-05-31","2":"660.0","3":"685.0","4":"633.0","5":"680.0","6":"34.0","7":"5.3","8":"819773500"},{"1":"2011-04-28","2":"671.0","3":"676.0","4":"619.0","5":"646.0","6":"-24.0","7":"-3.6","8":"962526500"},{"1":"2011-03-31","2":"765.0","3":"773.0","4":"566.0","5":"670.0","6":"-94.0","7":"-12.3","8":"1441284000"},{"1":"2011-02-28","2":"677.0","3":"791.0","4":"669.0","5":"764.0","6":"84.0","7":"12.4","8":"1138324000"},{"1":"2011-01-31","2":"650.0","3":"719.0","4":"648.0","5":"680.0","6":"36.0","7":"5.6","8":"808771500"},{"1":"2010-12-30","2":"650.0","3":"667.0","4":"640.0","5":"644.0","6":"0.0","7":"0.0","8":"827442500"},{"1":"2010-11-30","2":"566.2","3":"668.0","4":"560.0","5":"644.0","6":"72.2","7":"12.6","8":"1048048000"},{"1":"2010-10-29","2":"601.0","3":"604.0","4":"566.0","5":"571.8","6":"-27.8","7":"-4.6","8":"909762000"},{"1":"2010-09-30","2":"570.0","3":"631.0","4":"561.2","5":"599.6","6":"27.6","7":"4.8","8":"1018424000"},{"1":"2010-08-31","2":"612.0","3":"639.0","4":"570.0","5":"572.0","6":"-38.0","7":"-6.2","8":"1035877000"},{"1":"2010-07-30","2":"608.0","3":"656.0","4":"600.0","5":"610.0","6":"-6.0","7":"-1.0","8":"762692500"},{"1":"2010-06-30","2":"652.0","3":"677.0","4":"606.0","5":"616.0","6":"-40.0","7":"-6.1","8":"918870500"},{"1":"2010-05-31","2":"712.0","3":"732.0","4":"635.0","5":"656.0","6":"-77.0","7":"-10.5","8":"1078280000"},{"1":"2010-04-30","2":"751.0","3":"766.0","4":"712.0","5":"733.0","6":"-16.0","7":"-2.1","8":"974945500"},{"1":"2010-03-31","2":"666.0","3":"759.0","4":"656.0","5":"749.0","6":"83.0","7":"12.5","8":"1176891500"},{"1":"2010-02-26","2":"699.0","3":"730.0","4":"639.0","5":"666.0","6":"-32.0","7":"-4.6","8":"2061942000"},{"1":"2010-01-29","2":"780.0","3":"847.0","4":"696.0","5":"698.0","6":"-78.0","7":"-10.1","8":"1189117000"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>　<br>
　月次収益率の十二ヶ月平均が月次平均収益率になりますので、データがそろっている年の月次平均収益率と標準偏差を算出します。</p>
<div class="cell">
<details><summary>月次平均収益率と標準偏差を求める</summary><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="va">stock</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>年 <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="va">日付</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">年</span> <span class="op">&gt;=</span> <span class="fl">2010</span> <span class="op">&amp;</span> <span class="va">年</span> <span class="op">&lt;=</span> <span class="fl">2021</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">年</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>月次平均収益率 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">月次収益率</span><span class="op">)</span>,
                   標準偏差 <span class="op">=</span> <span class="fu">SD</span><span class="op">(</span><span class="va">月次収益率</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">df_print</span><span class="op">(</span><span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["年"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["月次平均収益率"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["標準偏差"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"2010","2":"-1.27","3":"7.38"},{"1":"2011","2":"-1.62","3":"6.99"},{"1":"2012","2":"4.14","3":"8.64"},{"1":"2013","2":"4.13","3":"4.99"},{"1":"2014","2":"1.52","3":"5.61"},{"1":"2015","2":"0.05","3":"5.13"},{"1":"2016","2":"-0.27","3":"9.24"},{"1":"2017","2":"0.48","3":"3.94"},{"1":"2018","2":"-0.89","3":"4.32"},{"1":"2019","2":"1.64","3":"3.85"},{"1":"2020","2":"0.47","3":"6.82"},{"1":"2021","2":"2.52","3":"5.90"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>　<br>
　上記を可視化します。</p>
<div class="cell">
<details><summary>月次平均収益率と標準偏差を可視化する</summary><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="va">stock</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>年 <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="va">日付</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">年</span> <span class="op">&gt;=</span> <span class="fl">2010</span> <span class="op">&amp;</span> <span class="va">年</span> <span class="op">&lt;=</span> <span class="fl">2021</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">年</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>月次平均収益率 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">月次収益率</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
                            <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,
                   標準偏差 <span class="op">=</span> <span class="fu">SD</span><span class="op">(</span><span class="va">月次収益率</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">年</span>, y <span class="op">=</span> <span class="va">月次平均収益率</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>, position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_errorbar</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymax <span class="op">=</span> <span class="va">月次平均収益率</span> <span class="op">+</span> <span class="va">標準偏差</span>,
                                        ymin <span class="op">=</span> <span class="va">月次平均収益率</span> <span class="op">-</span> <span class="va">標準偏差</span><span class="op">)</span>,
                           position <span class="op">=</span> <span class="st">"dodge"</span>, width <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="chapter05_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>　<br>
　月次平均収益率だけを見ていても儲けられる株かどうかの判断が難しいので、参考までに隔月の終値の変動を可視化します。</p>
<div class="cell">
<details><summary>終値の変動を可視化する</summary><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="va">stock</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">日付</span>, y <span class="op">=</span> <span class="va">終値</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="chapter05_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details><summary>直近三年の月次収益率の変動を可視化する</summary><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="va">stock</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>年 <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="va">日付</span><span class="op">)</span>, 月 <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/month.html">month</a></span><span class="op">(</span><span class="va">日付</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">年</span> <span class="op">&gt;=</span> <span class="fl">2019</span> <span class="op">&amp;</span> <span class="va">年</span> <span class="op">&lt;=</span> <span class="fl">2021</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>年 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">年</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">月</span>, y <span class="op">=</span> <span class="va">月次収益率</span>, fill <span class="op">=</span> <span class="va">年</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>, position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="chapter05_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>　</p>
<section id="複数の株を比較する" class="level3" data-number="5.3.1"><h3 data-number="5.3.1" class="anchored" data-anchor-id="複数の株を比較する">
<span class="header-section-number">5.3.1</span> 複数の株を比較する</h3>
<p>　複数の同業種銘柄を比較してみます。どの株が儲かりそうでしょうか？</p>
<div class="cell" data-hash="chapter05_cache/html/unnamed-chunk-16_a70d514b5b5df4f081fefaa4037be888">
<details><summary>6銘柄の月次平均収益率と標準偏差を可視化する</summary><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="va">url1</span> <span class="op">&lt;-</span> <span class="st">"https://kabutan.jp/stock/kabuka?code="</span>
<span class="va">url2</span> <span class="op">&lt;-</span> <span class="st">"&amp;ashi=mon&amp;page="</span>
<span class="va">pages</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>
<span class="va">xpath</span> <span class="op">&lt;-</span> <span class="st">'//*[@id="stock_kabuka_table"]/table[2]'</span>
<span class="va">code</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">7201</span>, <span class="fl">7203</span>, <span class="fl">7211</span>, <span class="fl">7261</span>, <span class="fl">7267</span>, <span class="fl">7270</span><span class="op">)</span>

<span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand.html">crossing</a></span><span class="op">(</span><span class="va">code</span>, <span class="va">pages</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>url <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">url1</span>, <span class="va">code</span>, <span class="va">url2</span>, <span class="va">pages</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="co"># dplyr::select(-pages) %&gt;% </span>
  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html">pmap_df</a></span><span class="op">(</span>.f <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">url</span>, <span class="va">code</span>, <span class="va">pages</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu">xml2</span><span class="fu">::</span><span class="fu"><a href="http://xml2.r-lib.org/reference/read_xml.html">read_html</a></span><span class="op">(</span><span class="va">url</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
      <span class="fu">rvest</span><span class="fu">::</span><span class="fu"><a href="https://rvest.tidyverse.org/reference/html_element.html">html_element</a></span><span class="op">(</span>xpath <span class="op">=</span> <span class="va">xpath</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
      <span class="fu">rvest</span><span class="fu">::</span><span class="fu"><a href="https://rvest.tidyverse.org/reference/html_table.html">html_table</a></span><span class="op">(</span>header <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>code <span class="op">=</span> <span class="va">code</span>, page <span class="op">=</span> <span class="va">pages</span><span class="op">)</span>
  <span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span>.cols <span class="op">=</span> <span class="fu">tidyselect</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"X"</span><span class="op">)</span>,
                              .fns <span class="op">=</span> <span class="fu">readr</span><span class="fu">::</span><span class="va"><a href="https://readr.tidyverse.org/reference/parse_guess.html">parse_guess</a></span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>date <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/as_date.html">as_date</a></span><span class="op">(</span><span class="va">X1</span><span class="op">)</span>,
                year <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span>,
                code <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">code</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">&gt;=</span> <span class="fl">2010</span> <span class="op">&amp;</span> <span class="va">year</span> <span class="op">&lt;=</span> <span class="fl">2021</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">code</span>, <span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">X7</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">X7</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">mean</span>, fill <span class="op">=</span> <span class="va">code</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, colour <span class="op">=</span> <span class="st">"gray"</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>, position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_errorbar</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymax <span class="op">=</span> <span class="va">mean</span> <span class="op">+</span> <span class="va">sd</span>,
                                        ymin <span class="op">=</span> <span class="va">mean</span> <span class="op">-</span> <span class="va">sd</span><span class="op">)</span>,
                           position <span class="op">=</span> <span class="st">"dodge"</span>, width <span class="op">=</span> <span class="fl">0.5</span>, size <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">code</span><span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="chapter05_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>


</section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
    } else {
      disableStylesheet(alternateStylesheets);
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } 
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./chapter04.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">そのデータは「月並み」か「特殊」か？ 標準偏差で評価する</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">Sampo Suzuki, CC 4.0 BY-NC-SA</div>   
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
<li class="nav-item compact">
    <a class="nav-link active" href="https://github.com/k-metrics/DAWS2022/" aria-current="page">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
</ul>
</div>
  </div>
</footer>


</body></html>